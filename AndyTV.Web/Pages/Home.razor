@page "/"
@inject IJSRuntime JSRuntime
@implements IAsyncDisposable

<PageTitle>AndyTV Web</PageTitle>

<div class="container">
    <h1>AndyTV Web Player</h1>

    <div class="video-container" style="max-width: 800px; margin: 20px auto;">
        <video id="my-video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" style="width: 100%;">
        </video>
    </div>

    <div class="controls" style="text-align: center; margin-top: 20px;">
        <button class="btn btn-primary" @onclick="() => ChangeChannel(Stream1)">Al Jazeera English</button>
        <button class="btn btn-secondary" @onclick="() => ChangeChannel(Stream2)">ABC News Live</button>
    </div>
</div>

@code {
    private const string Stream1 = "https://live-hls-apps-aje-fa.getaj.net/AJE/index.m3u8";
    private const string Stream2 = "https://content.uplynk.com/channel/3324f2467c414329b3b0cc5cd987b6be.m3u8";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("window.videoPlayer.init", "my-video", Stream1);
        }
    }

    private async Task ChangeChannel(string url)
    {
        await JSRuntime.InvokeVoidAsync("window.videoPlayer.changeSource", url);
    }

    public async ValueTask DisposeAsync()
    {
        await JSRuntime.InvokeVoidAsync("window.videoPlayer.dispose");
    }
}