name: nuget-check

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:

jobs:
  check-outdated:
    runs-on: ubuntu-latest
    name: Check for outdated NuGet packages

    steps:
      - uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: 10.0.x

      - name: Check for outdated packages
        run: |
          echo "Checking for outdated top-level NuGet packages (including prerelease)..."
          dotnet list package --outdated --include-prerelease > outdated.txt
          cat outdated.txt
          
          # Count outdated packages (lines starting with > indicate outdated packages)
          OUTDATED_COUNT=$(grep -E "^\s+>" outdated.txt 2>/dev/null | wc -l)
          
          if [ "$OUTDATED_COUNT" -gt 0 ]; then
            echo ""
            echo "üì¶ Found $OUTDATED_COUNT outdated package(s):"
            grep -E "^\s+>" outdated.txt | while read line; do
              pkg=$(echo "$line" | awk '{print $2}')
              current=$(echo "$line" | awk '{print $3}')
              latest=$(echo "$line" | awk '{print $4}')
              echo "  ‚ö†Ô∏è $pkg: $current ‚Üí $latest"
            done
            echo ""
            echo "‚ÑπÔ∏è Outdated packages detected (informational only)"
          else
            echo ""
            echo "‚úÖ All packages are up to date"
          fi
